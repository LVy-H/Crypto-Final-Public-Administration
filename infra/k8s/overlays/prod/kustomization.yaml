# Production Kustomization
# Uses ExternalSecrets Operator for secret management
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: crypto-pqc-prod

resources:
  - ../../base
  - external-secrets.yaml
  - hpa.yaml
  - pdb.yaml

# Remove the base secrets (we use ExternalSecrets instead)
patchesJson6902:
  - target:
      group: ""
      version: v1
      kind: Secret
      name: crypto-secrets
    patch: |
      - op: remove
        path: /

# Production configurations
configMapGenerator:
  - name: crypto-config
    behavior: merge
    literals:
      - SPRING_PROFILES_ACTIVE=prod,kubernetes
      - LOGGING_LEVEL_ROOT=WARN
      - LOGGING_LEVEL_COM_GOV_CRYPTO=INFO

# Production replicas (with HPA, these are minimums)
replicas:
  - name: api-gateway
    count: 3
  - name: identity-service
    count: 3
  - name: ca-authority
    count: 2
  - name: cloud-sign
    count: 3
  - name: validation-service
    count: 3

# Use tagged images in production
images:
  - name: crypto-pqc/api-gateway
    newTag: v1.0.0
  - name: crypto-pqc/identity-service
    newTag: v1.0.0
  - name: crypto-pqc/ca-authority
    newTag: v1.0.0
  - name: crypto-pqc/cloud-sign
    newTag: v1.0.0
  - name: crypto-pqc/validation-service
    newTag: v1.0.0
