apiVersion: v1
kind: Namespace
metadata:
  name: crypto-pqc
  labels:
    app.kubernetes.io/name: crypto-pqc
    app.kubernetes.io/part-of: pqc-digital-signature

---
# ConfigMap for shared configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: crypto-config
data:
  # Service URLs (internal)
  SERVICE_CA_AUTHORITY_URL: "http://ca-authority:8082"
  SERVICE_CLOUD_SIGN_URL: "http://cloud-sign:8084"
  SERVICE_RA_SERVICE_URL: "http://ra-service:8083"
  SERVICE_VALIDATION_URL: "http://validation-service:8085"
  SERVICE_IDENTITY_URL: "http://identity-service:8081"

  # Database configuration
  POSTGRES_HOST: "postgres"
  POSTGRES_PORT: "5432"
  POSTGRES_DB: "crypto_db"

  # Spring profiles
  SPRING_PROFILES_ACTIVE: "kubernetes"

  # Logging
  LOGGING_LEVEL_ROOT: "INFO"
  LOGGING_LEVEL_COM_GOV_CRYPTO: "DEBUG"

---
# PostgreSQL ConfigMap
apiVersion: v1
kind: ConfigMap
metadata:
  name: postgres-config
data:
  init.sql: |
    -- Initialize databases for microservices
    CREATE DATABASE identity_db;
    CREATE DATABASE ca_db;
    CREATE DATABASE ra_db;
    CREATE DATABASE validation_db;
    CREATE DATABASE crypto_doc;
    CREATE DATABASE crypto_org;
    CREATE DATABASE crypto_cloud_sign;

    -- Create user with appropriate permissions
    GRANT ALL PRIVILEGES ON DATABASE identity_db TO admin;
    GRANT ALL PRIVILEGES ON DATABASE ca_db TO admin;
    GRANT ALL PRIVILEGES ON DATABASE ra_db TO admin;
    GRANT ALL PRIVILEGES ON DATABASE validation_db TO admin;
    GRANT ALL PRIVILEGES ON DATABASE crypto_doc TO admin;
    GRANT ALL PRIVILEGES ON DATABASE crypto_org TO admin;
    GRANT ALL PRIVILEGES ON DATABASE crypto_cloud_sign TO admin;
